
# Einstellung: SE param1, param2, param3, param4, param5, param6
# 	param1 - Wasseruhr Nr
# 	param2 - MinSoll
# 	param3 - MaxSoll
# 	param4 - Qn 1, 2, 3, 6 und 10 ~ 1.5, 2.5, 1.5N, 10N und 10
# 	param5 - Kubikmeter
# 	param6 - Liter, 1000 liter => 1 Kubikmeter

record(longout, "$(P)$(R)min_set")
{
    field(DESC, "Set minimal water flow rate (Liter/hour)")
    field(DTYP, "stream")
    field(OUT,  "@wasseruhr.proto min_set($(CHAN)) $(PORT)")
    field(DRVH, "30000")
    field(HOPR, "30000")
    field(LLSV, "MAJOR")
    field(LSV,  "MINOR")
    field(EGU,  "l/h")
    field(PRIO, "HIGH")
    info(autosaveFields_pass0, "VAL")
    info(autosaveFields_pass0, "LOLO")
    info(autosaveFields_pass0, "LOW")
    field(TPRO, "1")
}

record(longout, "$(P)$(R)max_set")
{
    field(DESC, "Set maximal water flow rate ")
    field(DTYP, "stream")
    field(OUT,  "@wasseruhr.proto max_set($(CHAN)) $(PORT)")
    field(DRVH, "30000")
    field(HOPR, "30000")
    field(LOPR, "1000")
    field(EGU,  "l/h")
    field(PRIO, "HIGH")
    #info(autosaveFields_pass0, "VAL")
}

record(mbbo, "$(P)$(R)Qn_set")
{
    field(DESC, "Set Qn value")
    field(DTYP, "stream")
    field(OUT,  "@wasseruhr.proto Qn_set($(CHAN)) $(PORT)")
    field(ZRST, "1.5")
    field(ONST, "2.5")
    field(TWST, "3.5")
    field(THST, "6")
    field(FRST, "10")
    field(PRIO, "HIGH")
    info(autosaveFields_pass0, "VAL")
    #field(TPRO, "1")
}

record(longout, "$(P)$(R)kubic_set")
{
    field(DESC, "Set cubic meter L/h")
    field(DTYP, "stream")
    field(OUT,  "@wasseruhr.proto kubic_set($(CHAN)) $(PORT)")
    field(DRVH, "1000")
    field(HOPR, "1000")
    field(LOPR, "0")
    field(EGU,  "m^3")
    field(PRIO, "HIGH")
}

record(longout, "$(P)$(R)liter_set")
{
    field(DESC, "Set liter")
    field(DTYP, "stream")
    field(OUT,  "@wasseruhr.proto liter_set($(P),$(R),$(CHAN)) $(PORT)")
    field(DRVH, "1000")
    field(HOPR, "1000")
    field(LOPR, "0")
    field(EGU,  "l")
    field(PRIO, "HIGH")
}

#############################################
# Statusausgabe: ST param1, param2, param3, param4, param5, param6, param7
# 	param1 - Wasseruhr Nr
# 	param2 - IstWert
# 	param3 - MinSoll
# 	param4 - MaxSoll
# 	param5 - Qn 1, 2, 3, 6 und 10 ~ 1.5, 2.5, 1.5N, 10N und 10
# 	param6 - Kubikmeter
# 	param7 - Liter, 1000 liter => 1 Kubikmeter

record(longin, "$(P)$(R)flow_get")
{
    field(DESC, "Show current water flow rate")
    field(EGU,  "l/h")
    #field(TPRO, "1")
}

record(longin, "$(P)$(R)min_get")
{
    field(DESC, "Show minimal water flow rate")
    field(EGU,  "l/h")
    #field(TPRO, "1")
}

record(longin, "$(P)$(R)max_get")
{
    field(DESC, "Show maximal water flow rate")
    field(EGU,  "l/h")
    #field(TPRO, "1")
}

record(longin, "$(P)$(R)kubic_get")
{
    field(DESC, "Show cubic meter")
    field(EGU,  "m^3")
    #field(TPRO, "1")
}

record(mbbi, "$(P)$(R)Qn_get")
{
    field(DESC, "Get Qn value")
    field(ZRST, "1.5")
    field(ONST, "2.5")
    field(TWST, "1.5N")
    field(THST, "10.N")
    field(FRST, "10.0")
    #field(TPRO, "1")
}

record(longin, "$(P)$(R)liter_get")
{
    field(DESC, "Show liter")
    field(DTYP, "stream")
    field(INP,  "@wasseruhr.proto status_get($(P),$(R),$(CHAN)) $(PORT)")
    field(EGU,  "l")
    field(PINI, "YES")
    field(SCAN, "5 second")
    #field(TPRO, "1")
}
#############################################
# CL - clear interlock
record(ao, "$(P)$(R)clear_set")
{
    field(DESC, "Clear the interlock queue")
    field(DTYP, "stream")
    field(OUT,  "@wasseruhr.proto clear_set($(CHAN)) $(PORT)")
    field(DRVH, "1")
    field(HOPR, "1")
    field(LOPR, "1")
    field(PRIO, "HIGH")
    field(FLNK, "$(P)$(R)trigger_ok")
}

##############################################
# Alarm: Al 1 - 15
 
record(bi, "mexh3:wm_wedlposu01:alarm")
{
    field(DESC, "Show status of water meter 1")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(TPRO, "1")
    field(FLNK, "trigger1-TS")
}
record(bi, "steam:wm_laser:alarm")
{
    field(DESC, "Show status of water meter 2")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(TPRO, "1")
    field(FLNK, "trigger2-TS")
}
record(bi, "melba_060:wm_beamdump:alarm")
{
    field(DESC, "Show status of water meter 3")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(TPRO, "1")
    field(FLNK, "trigger3-TS")
}
record(bi, "pos4:res4:alarm")
{
    field(DESC, "Show status of water meter 4")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(TPRO, "1")
    field(FLNK, "trigger4-TS")
}
record(bi, "pos5:res5:alarm")
{
    field(DESC, "Show status of water meter 5")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "trigger5-TS")
}
record(bi, "pos6:res6:alarm")
{
    field(DESC, "Show status of water meter 6")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "trigger6-TS")
}
record(bi, "pos7:res7:alarm")
{
    field(DESC, "Show status of water meter 7")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "trigger7-TS")
}
record(bi, "pos8:res8:alarm")
{
    field(DESC, "Show status of water meter 8")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "trigger8-TS")
}
record(bi, "pos9:res9:alarm")
{
    field(DESC, "Show status of water meter 9")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "trigger9-TS")
}
record(bi, "pos10:res10:alarm")
{
    field(DESC, "Show status of water meter 10")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "trigger10-TS")
}
record(bi, "pos11:res11:alarm")
{
    field(DESC, "Show status of water meter 11")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "trigger11-TS")
}
record(bi, "pos12:res12:alarm")
{
    field(DESC, "Show status of water meter 12")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "trigger12-TS")
}
record(bi, "pos13:res13:alarm")
{
    field(DESC, "Show status of water meter 13")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "trigger13-TS")
}
record(bi, "pos14:res14:alarm")
{
    field(DESC, "Show status of water meter 14")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "trigger14-TS")
}
record(bi, "pos15:res15:alarm")
{
    field(DESC, "Show status of water meter 15")
    field(DTYP, "stream")
    field(INP,  "@wasseruhr.proto alarm_get $(PORT)")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(SCAN, "10 second")
    field(FLNK, "trigger15-TS")
}

#timestamp alarm of water meter 

record(calcout, "trigger$(CHAN)-TS")
{
    field(INPA, "$(P)$(R)alarm")
    field(OOPT, "Transition To Non-zero")
    field(CALC, "A=1")
    field(OUT,  "$(P)$(R)timestamp.PROC")
    field(TPRO, "1")
}



 record (stringin, "$(P)$(R)timestamp")
{
      field(DESC, "Timestamp the alarm water meter")
      field(DTYP, "Soft Timestamp")
      field(INP,  "@%b %d, %Y %H:%M:%S")
      #field(INP,  "@%b %d, %Y %H:%M:%S.%0f")
      field(TPRO, "1")
}

record (stringin, "$(P)$(R)device_set")
{
    field(DESC, "Input the monitored device")
    field(DTYP, "Soft Channel")
    info(autosaveFields_pass0, "VAL")
}

record(calcout, "$(P)$(R)trigger_ok")
{
    field(INPA, "$(P)$(R)alarm")
    field(CALC, "A=0")
    field(OUT,  "$(P)$(R)timestamp.PROC")
    field(TPRO, "1")
}
