
# Einstellung: SE param1, param2, param3, param4, param5, param6
# 	param1 - Wasseruhr Nr
# 	param2 - MinSoll
# 	param3 - MaxSoll
# 	param4 - Qn 1, 2, 3, 6 und 10 ~ 1.5, 2.5, 1.5N, 10N und 10
# 	param5 - Kubikmeter
# 	param6 - Liter, 1000 liter => 1 Kubikmeter
 
record(longout, "$(CARD):$(CHAN):Min:set")
{
    field(DESC, "Set minimal water flow rate (Liter/hour)")
    field(DTYP, "stream")
    field(OUT,  "@wasseruhr.proto set:uhr:Min($(CARD),$(CHAN)) $(PORT)")
    field(DRVH, "30000")
    field(HOPR, "30000")
    field(EGU,  "l/h")
    field(PRIO, "HIGH")
}

record(longout, "$(CARD):$(CHAN):Max:set")
{
    field(DESC, "Set maximal water flow rate ")
    field(DTYP, "stream")
    field(OUT,  "@wasseruhr.proto set:uhr:Max($(CARD),$(CHAN)) $(PORT)")
    field(DRVH, "30000")
    field(HOPR, "30000")
    field(EGU,  "l/h")
    field(PRIO, "HIGH")
}

record(mbbo, "$(CARD):$(CHAN):Qn:set")
{
    field(DESC, "Set Qn value")
    field(DTYP, "stream")
    field(OUT,  "@wasseruhr.proto set:uhr:Qn($(CARD),$(CHAN)) $(PORT)")
    field(ZRST, "1.5")
    field(ONST, "2.5")
    field(TWST, "3.5")
    field(THST, "6")
    field(FRST, "10")
    field(PRIO, "HIGH")
}

record(longout, "$(CARD):$(CHAN):Kubic:set")
{
    field(DESC, "Set cubic meter L/h")
    field(DTYP, "stream")
    field(OUT,  "@wasseruhr.proto set:uhr:Kubic($(CARD),$(CHAN)) $(PORT)")
    field(DRVH, "1000")
    field(HOPR, "1000")
    field(LOPR, "0")
    field(EGU,  "m^3")
    field(PRIO, "HIGH")
}

record(longout, "$(CARD):$(CHAN):Liter:set")
{
    field(DESC, "Set liter")
    field(DTYP, "stream")
    field(OUT,  "@wasseruhr.proto set:uhr:Liter($(CARD),$(CHAN)) $(PORT)")
    field(DRVH, "1000")
    field(HOPR, "1000")
    field(LOPR, "0")
    field(EGU,  "l")
    field(PRIO, "HIGH")
}

#############################################
# Statusausgabe: ST param1, param2, param3, param4, param5, param6, param7
# 	param1 - Wasseruhr Nr
# 	param2 - IstWert
# 	param3 - MinSoll
# 	param4 - MaxSoll
# 	param5 - Qn 1, 2, 3, 6 und 10 ~ 1.5, 2.5, 1.5N, 10N und 10
# 	param6 - Kubikmeter
# 	param7 - Liter, 1000 liter => 1 Kubikmeter


record(longin, "$(CARD):$(CHAN):Flow:get")
{
    field(DESC, "Show current water flow rate")
    field(EGU,  "l/h")
    #field(TPRO, "1")
}

record(longin, "$(CARD):$(CHAN):Min:get")
{
    field(DESC, "Show minimal water flow rate")
    field(EGU,  "l/h")
    #field(TPRO, "1")
}

record(longin, "$(CARD):$(CHAN):Max:get")
{
    field(DESC, "Show maximal water flow rate")
    field(EGU,  "l/h")
    #field(TPRO, "1")
}

record(longin, "$(CARD):$(CHAN):Kubic:get")
{
    field(DESC, "Show cubic meter")
    field(EGU,  "m^3")
    #field(TPRO, "1")
}

record(mbbi, "$(CARD):$(CHAN):Qn:get")
{
    field(DESC, "Get Qn value")
    field(ZRST, "1.5")
    field(ONST, "2.5")
    field(TWST, "1.5N")
    field(THST, "10.N")
    field(FRST, "10.0")
    #field(TPRO, "1")
}

record(longin, "$(CARD):$(CHAN):Liter:get")
{
    field(DESC, "Show liter")
    field(DTYP, "stream")
    field(INP,  "@wasseruhr.proto get:uhr:status($(CARD),$(CHAN)) $(PORT)")
    field(EGU,  "l")
    field(PINI, "YES")
    field(SCAN, "1 second")
    #field(TPRO, "1")
}
#############################################
# CL - clear interlock
record(ao, "$(CARD):$(CHAN):CL:set")
{
    field(DESC, "Clear the interlock queue")
    field(DTYP, "stream")
    field(OUT,  "@wasseruhr.proto set:uhr:CL($(CARD),$(CHAN)) $(PORT)")
    field(DRVH, "1")
    field(HOPR, "1")
    field(LOPR, "1")
    field(PRIO, "HIGH")
    field(FLNK, "$(CARD):$(CHAN):trigger-default")
}

##############################################
# Alarm: Al 1 - 15
 
record(bi, "$(CARD):1:alarm")
{
    field(DESC, "Show status of water meter 1")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    #field(TPRO, "1")
    field(FLNK, "$(CARD):1:trigger-TS")
}
record(bi, "$(CARD):2:alarm")
{
    field(DESC, "Show status of water meter 2")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "$(CARD):2:trigger-TS")
}
record(bi, "$(CARD):3:alarm")
{
    field(DESC, "Show status of water meter 3")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "$(CARD):3:trigger-TS")
}
record(bi, "$(CARD):4:alarm")
{
    field(DESC, "Show status of water meter 4")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "$(CARD):4:trigger-TS")
}
record(bi, "$(CARD):5:alarm")
{
    field(DESC, "Show status of water meter 5")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "$(CARD):5:trigger-TS")
}
record(bi, "$(CARD):6:alarm")
{
    field(DESC, "Show status of water meter 6")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "$(CARD):6:trigger-TS")
}
record(bi, "$(CARD):7:alarm")
{
    field(DESC, "Show status of water meter 7")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "$(CARD):7:trigger-TS")
}
record(bi, "$(CARD):8:alarm")
{
    field(DESC, "Show status of water meter 8")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "$(CARD):8:trigger-TS")
}
record(bi, "$(CARD):9:alarm")
{
    field(DESC, "Show status of water meter 9")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "$(CARD):9:trigger-TS")
}
record(bi, "$(CARD):10:alarm")
{
    field(DESC, "Show status of water meter 10")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "$(CARD):10:trigger-TS")
}
record(bi, "$(CARD):11:alarm")
{
    field(DESC, "Show status of water meter 11")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "$(CARD):11:trigger-TS")
}
record(bi, "$(CARD):12:alarm")
{
    field(DESC, "Show status of water meter 12")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "$(CARD):12:trigger-TS")
}
record(bi, "$(CARD):13:alarm")
{
    field(DESC, "Show status of water meter 13")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "$(CARD):13:trigger-TS")
}
record(bi, "$(CARD):14:alarm")
{
    field(DESC, "Show status of water meter 14")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(FLNK, "$(CARD):14:trigger-TS")
}
record(bi, "$(CARD):15:alarm")
{
    field(DESC, "Show status of water meter 15")
    field(DTYP, "stream")
    field(INP,  "@wasseruhr.proto get:uhr:alarm($(CARD)) $(PORT)")
    field(ZNAM, "OK")
    field(ONAM, "Alarm")
    field(OSV,  "MAJOR")
    field(SCAN, "1 second")
    field(FLNK, "$(CARD):15:trigger-TS")
}

#timestamp alarm of water meter
record(calcout, "$(CARD):$(CHAN):trigger-TS")
{
    field(INPA, "$(CARD):$(CHAN):alarm")
    field(OOPT, "Transition To Non-zero")
    field(CALC, "A=1")
    field(OUT,  "$(CARD):$(CHAN):alarm-timestamp.PROC")
    field(TPRO, "1")
}

record(calcout, "$(CARD):$(CHAN):trigger-default")
{
    field(INPA, "$(CARD):$(CHAN):alarm")
    field(CALC, "A=0")
    field(OUT,  "$(CARD):$(CHAN):alarm-timestamp.PROC")
    field(TPRO, "1")
}

record (stringin, "$(CARD):$(CHAN):alarm-timestamp")
{
    field(DESC, "Timestamp the alarm water meter")
    field(DTYP, "Soft Timestamp")
    field(INP,  "@%b %d, %Y %H:%M:%S")
    #field(INP,  "@%b %d, %Y %H:%M:%S.%0f")
    field(TPRO, "1")
}
